{% extends 'users/base.html' %}
{% load static compress %}

{% block title %}Dashboard{% endblock %}
{% block header %}Dashboard{% endblock %}

{% block content %}
    <div class="dashboard-container">
        {% if user.role == 'admin' %}
            {% include 'users/_sidebar_admin.html' %} 
        {% elif user.role == 'manager' %}
            {% include 'users/_sidebar_manager.html' %} 
        {% elif user.role == 'employee' %}
            {% include 'users/_sidebar_employee.html' %} 
        {% endif %}

        <div class="dashboard-content">
            {% if user.role == 'admin' %}
                {# Admin-specific content #}
                {% include 'users/_stats_cards.html' with stats=admin_stats %}
            {% elif user.role == 'manager' %}
                {# Manager-specific content #}
                {% include 'users/_stats_cards.html' with stats=manager_stats %}  {# Assuming you have manager_stats context #}
                {% include 'users/_performance_chart.html' with labels=performance_labels data=performance_data %}
            {% elif user.role == 'employee' %}
                {# Employee-specific content #}
                <h2>Welcome, {{ user.get_full_name }}!</h2>
                {% include 'users/_performance_chart.html' with labels=performance_labels data=performance_data %}
            {% endif %}
        </div>
        <div style="display: none;">
            <div id="performanceChartData">
                {{ chart_data|json_script:"performanceChartData" }}  </div>
        </div>
    </div>
{% endblock %}

{% block footer %}
    {% compress js %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static 'js/dashboard.js' %}"></script>
    {% endcompress %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Get the canvas element
            const ctx = document.getElementById('performanceChart').getContext('2d');

            // Safely retrieve the chart data from the template
            const chartData = JSON.parse(document.getElementById('performanceChartData').textContent);

            // Create the chart
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: 'Sales Performance',
                        data: chartData.data,
                        backgroundColor: 'rgba(75, 192, 192, 0.4)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        fill: true,
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
    </script>
{% endblock %}